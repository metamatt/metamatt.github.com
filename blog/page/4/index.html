
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Step 2 is the hard part.</title>
  <meta name="author" content="Matt Ginzton">

  
  <meta name="description" content="Apple updated the MacBook Pro lineup this week, with both evolutionary
enhancements recognizable as successors to the previous lineup, and also &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://blog.metamatt.com/blog/page/4/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="Step 2 is the hard part." type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-19563060-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Step 2 is the hard part.</a></h1>
  
    <h2>Matt Ginzton writes here.</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:blog.metamatt.com" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/06/15/apples-june-2012-macbook-pro-pricing/">Apple&#8217;s June 2012 MacBook Pro Pricing</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-06-15T00:00:00-07:00" pubdate data-updated="true">Jun 15<span>th</span>, 2012</time>
        
         | <a href="/blog/2012/06/15/apples-june-2012-macbook-pro-pricing/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Apple updated the MacBook Pro lineup this week, with both evolutionary
enhancements recognizable as successors to the previous lineup, and also
adding a new option branded as a member of the same family (&#8220;MacBook Pro with
Retina Display&#8221;) which is actually a whole new model. It&#8217;s not an improved
display option for the same machine, as the name implies: it&#8217;s thinner and
lighter with an entirely different case design, different set of external
ports, no optical drive, and vastly different (and less upgradeable)
internals.</p>

<p>To my thinking, it&#8217;s closer to a 15&#8221; MacBook Air than a true MacBook Pro.</p>

<p>That doesn&#8217;t affect whether you should buy one, but I do find it interesting.</p>

<p>Predictably, people are <a href="http://daringfireball.net/2012/06/three_takeaways_wwdc">gushing about the display and complaining about the
price</a>. Apple
positions it as the high-end option in the <a href="http://store.a%0Apple.com/us/browse/home/shop_mac/family/macbook_pro/select">MacBook Pro lineup</a> (13&#8221; starting at
$1199, 15&#8221; starting at $1799, and 15&#8221; Retina model starting at $2199). No,
that&#8217;s not cheap, but let&#8217;s consider: the lowest-speced Retina model has a 2.3
GHz quad-core processor, 8GB of RAM, and a 256GB SSD for $2199; the 15&#8221; non-
Retina model with the $1799 price tag has the same processor but 4GB of RAM
and a spinning hard drive.</p>

<p>If you equalize the storage and memory options, Apple wants $100 for the
memory upgrade and $500 for the SSD upgrade. Leave aside the question of
whether those are fair component prices — they&#8217;re the same components Apple is
including in the base level of the Retina model. So this brings the price of
the non-Retina model to $2399, or $200 above the Retina model. With equivalent
specs, the Retina model is actually cheaper!</p>

<p>This point is exacerbated by the display options — the non-Retina model
actually offers a choice of displays, and the base price includes the lower-
resolution 1440x900 display. For $100 more, you can get a 1680x1050 display
&#8220;with 36 per cent more pixels&#8221;. Or, for $200 less, you can get the Retina
model with, um, 300% more pixels, if you&#8217;re into that sort of thing.</p>

<p>This difference carries over to the higher-spec model too. In chart form:</p>

<table cellspacing="6"><tr><td>CPU</td><td>2.3 GHz quad-core
i7</td><td>2.6 GHz quad-core i7</td></tr><tr><td>RAM</td><td>8GB</td><td>
8GB</td></tr><tr><td>SSD</td><td>256GB</td><td>512GB</td></tr><tr><td>Pr
ice with 1440x900 (non-Retina)
display</td><td>$2,399</td><td>$3,099</td></tr><tr><td>Price with
1650x1050 (non-Retina)
display</td><td>$2,499</td><td>$3,199</td></tr><tr><td>Price with
2880x1800 (Retina) display</td><td>$2,199</td><td>$2,799</td></tr></table>


<p>(In fact, note that the spread between the Retina model and its 1440x900
sibling has grown to $300 in the 2.6GHz model, because once you cancel out the
cost of the storage and RAM upgrades bundled into the faster model, Apple
wants $200 for the faster CPU in the non-Retina model, and $100 for the same
CPU upgrade in the Retina model.)</p>

<p>Now, the older (non-Retina) &#8220;MacBook Pro&#8221; models do have some advantages over
the Retina model: Firewire and Ethernet ports, the option of a matte screen,
an optical drive, room for larger hard drives, standard components that can be
upgraded, and (combining these last 3 qualities) the ability to replace the
optical drive with a second hard drive or SSD. For some people, these
qualities might actually be worth more money. And true, these machines do
start at a lower price point than the Retina model, if you&#8217;re willing to go
with spinning storage and less RAM. But comparing apples to apples (can… not…
resist… use… of… phrase), it&#8217;s not true that the Retina model is more
expensive.</p>

<p>In fact, what I find interesting here is what the pricing says about Apple&#8217;s
priorities. They&#8217;re actually trying to push people in the direction of the new
model, at least at the high end. I presume it costs more to build than the
non-Retina model, and I think you could build an argument it should sell for
more than the non-Retina model. It would probably still sell (it&#8217;s lustworthy
and has no direct competition). But it would not sell as well.</p>

<p>Now we&#8217;re dealing with all Apple prices here, and they do charge well above
market rates for the RAM and SSD upgrades which the Retina MBP forces you to
opt into. So feel free to argue that it&#8217;s overpriced, if you think so. You can
also argue that all this proves is that the non-Retina MBPs are even more
overpriced. But the bottom line is that for anyone already considering a high-
end MacBook Pro with SSD anyway, the price on the Retina models is low —
surprisingly low, even.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/03/19/openwrt-is-losing-its-luster/">OpenWrt Is Losing Its Luster</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-03-19T00:00:00-07:00" pubdate data-updated="true">Mar 19<span>th</span>, 2012</time>
        
         | <a href="/blog/2012/03/19/openwrt-is-losing-its-luster/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Ever since I discovered it in 2006, I&#8217;ve used, and been a huge fan of,
<a href="https://openwrt.org/">OpenWrt</a> for my home network router. I started running
the venerable Whiterussian release on a genuine WRT54G, at a time when I
wanted to tweak some configuration options that the stock firmware didn&#8217;t give
me control over; I dabbled in alternate firmware like Tomato and HyperWRT but
quickly found that their filesystem layout made them too hard to customize;
then I discovered OpenWRT and found the design far saner.</p>

<p>While my original purpose in looking past the factory firmware (power boosting
to increase range) didn&#8217;t work out well (it boosted the signal and the noise,
with little effect on range — go figure — replacing the antenna worked far
better), I soon found myself addicted to several features of a fully
configurable router. Probably at least half of what I loved about OpenWRT can
be attributed directly to
<a href="http://www.thekelleys.org.uk/dnsmasq/doc.html">dnsmasq</a>, a wonderfully clever
piece of software that acts as both DHCP and DNS servers, and coordinates
across the two protocols, so that in general, all DHCP clients get entered in
the DNS with reasonable hostnames. (This solves the same problem that
Microsoft tried to solve with NetBIOS and WINS, and that Apple tried to solve
with Rendezvous/Bonjour, but the dnsmasq approach doesn&#8217;t require any new
protocols or software on any of the clients — DNS just works.) Beyond dnsmasq,
here is a short list of things I ended up configuring my OpenWrt router to do,
which I hadn&#8217;t realized I needed, but once available proved to be very useful:</p>

<ul>
<li>OpenVPN server: set up an offsite file server at a friend&#8217;s house for offsite backup</li>
<li>avahi: to forward mDNS across the OpenVPN link as appropriate</li>
<li>VLAN support: in addition to my private LAN, I ran a separate semi-public network with wireless access points using a separate SSID bridged onto a separate VLAN which had access to the internet but not my LAN</li>
<li>tcpdump: whenever having network problems, the ability to sniff traffic on the router is invaluable in troubleshooting them</li>
</ul>


<p>This worked great for years, but as time passed eventually the WRT54G got
flaky and started rebooting every few days. When it came time to replace it, I
wanted newer and faster hardware — compared to 2002-era hardware, I wanted
more RAM, more flash storage, gigabit wired networking, and N-speed wireless
networking. This was 2010, and such hardware was readily available. I picked a
suitable-looking model with good hardware (Netgear WNDR3700), installed the
current OpenWrt release (10.03, Backfire), and at first things were great1.</p>

<p>Then, what&#8217;s the problem, you may ask? Well, over time I started experiencing
a raft of weird problems, to be detailed below, and slowly but surely I
started associating them with the current version of OpenWRT. I tried newer
versions, filing bug reports and asking for help in the forums, and even
switching to different hardware, but eventually these problems piled up to the
point I decided to switch away. I still have a lot of respect for the project
and its volunteer developers, but it just wasn&#8217;t working out for me. My
unprovable hypothesis is this: Openwrt originally started as a fork of the
GPL-mandated open source drop of Linksys&#8217; own WRT54G firmware, and thanks to
Linksys&#8217; own engineering and binary drivers for the specific hardware they
used, the result wasn&#8217;t particularly clean but worked great. Over time, as
OpenWrt started running on more and more hardware, and started tracking closer
to stock Linux instead of vendor-provided customizations, and using open
source drivers instead of opaque vendor binary drivers, it has to deal with
more configuration sprawl and gets less benefit from the vendor QA and the
result, while much cleaner, is also flakier. I don&#8217;t know that this is true,
but in terms of pure stability, I never had a problem with Whiterussian on
2002-era hardware (Linksys WRT54G and Asus WL500G-P), whereas I saw all sorts
of weirdness with Backfire on 2010-era hardware (Netgear WNDR3700 and Buffalo
WZR-HP-300N).</p>

<p>On to the problem list:</p>

<ol>
<li><p>On the WNDR3700, internet connectivity would occasionally just stop. My LAN would be fine, except no contact with the outside world. I first blamed this on my cable modem and provider (hence <a href="http://blog.metamatt.com/blog/2011/04/07/state-of-the-last-mile-internet-connection-year-2009/">this</a> <a href="http://blog.metamatt.com/blog/2011/04/09/state-of-the-last-mile-internet-connection-year-2011/">series</a> <a href="http://blog.metamatt.com/blog/2011/06/13/update-on-comcast-last-mile-isp-connection/">of</a> <a href="http://blog.metamatt.com/blog/2011/06/23/not-the-modem-after-all/">articles</a>), and at the time I&#8217;d had such a good experience with OpenWrt that it was a long time before I thought to blame the router, but eventually I looked in that direction, and found eth1 would get into a stuck state that I could reset either by replugging the cable or using mii-tool to reset the media interface. <a href="https://forum.openwrt.org/viewtopic.php?id=30655">I posted about this on the OpenWrt forum</a>, without hearing much.</p></li>
<li><p>Because of that problem, and because I couldn&#8217;t tell whether it was hardware or software at fault, I did the extremely scientific thing of changing two variables at once, and bought a different router (Buffalo WZR-HP-300N) and installed a newer Backfire (10.03.1) on it. I didn&#8217;t have the eth1 problem any more. But I did have a different and equally annoying problem at approximately the same frequency: dnsmasq would stop serving requests. Since it&#8217;s responsible for both DHCP and DNS, this was fairly crippling. I&#8217;m loathe to blame dnsmasq itself since I&#8217;ve never seen this behavior from it in any other install, and also because this was accompanied by weird system level behavior: when it got into this state, I was unable to kill -9 the dnsmasq process, nslookup processes on the router would also become unkillable, and the router would fail to soft-reboot — I had to hard power cycle it. <a href="http://blog.metamatt.com/blog/2011/04/09/state-of-the-last-mile-internet-connection-year-2011/">I posted about this on the OpenWrt forum</a> as well, to deafening silence.</p></li>
<li><p>I&#8217;d see a low but present rate of DNS lookup request failures — a valid request would return NXDOMAIN, and repeated immediately would succeed. This caused a small amount of application-layer collateral damage and general flakiness. Of course, I don&#8217;t know whether to blame Backfire or dnsmasq or something else. But I saw this problem during the 2 years I used Backfire as my main router, and not before or since.</p></li>
<li><p>The OpenVPN link would eventually stop carrying traffic. Traffic that should be routed over the VPN link would just disappear. At this point, I&#8217;d try troubleshooting first with tcpdump, then by adding verbose logging like echo-a-character-for-each-packet in OpenVPN (which requires restarting the server), then restarting the firewall a few times, and none of these changes would make a difference immediately, but after restarting both OpenVPN and the firewall a few times each (without making any configuration changes other than enabling logging), suddenly I&#8217;d start seeing the echo characters and packets would flow; then I&#8217;d disable the logging and restart OpenVPN and it would work fine for a few more weeks. Again, I have no proof that Backfire was to blame here. But as in #3, I saw this problem during the 2 years I used Backfire as my main router, and not before or since.</p></li>
<li><p>My Xbox 360 suddenly found itself unable to sign into Xbox Live. I noticed this in January 2011 and while it&#8217;s hard to know exactly when it started or what changed, I hadn&#8217;t changed anything in the router configuration recently, so I suspect the Xbox dashboard update shortly before that made the critical change. But I blame OpenWrt, not the Xbox software, because I sniffed the traffic it was sending, and found weirdness. Specifically, the Xbox likes to use UPnP to open network ports, and I had miniupnpd enabled on the router to allow this, and in the broken state, the Xbox would make a UPnP request to forward UDP port 3074 to itself, then it would send outgoing UDP packets to something.xboxlive.com:3074, and the router would see that as eligible for the forwarding rule it just set up, and immediately reflect the Xbox&#8217;s own packet back to it. (It would also get NATted and go out on the WAN, and a few hundred milliseconds later a response would arrive from the real Xbox Live service, but by then the Xbox was already confused.) Meanwhile, the port forwarding wasn&#8217;t actually necessary because of the OpenWrt NAT implementation. So if I stopped miniupnpd, the Xbox would be able to sign into Live, but other things I run that want UPnP or NAT-PMP would break. I was able to have it both ways by blacklisting the Xbox from talking to miniupnpd, but this didn&#8217;t inspire confidence.</p></li>
</ol>


<p>Once I mentally assembled this list into one place, I realized there was
enough general weirdness here that I was no longer happy with OpenWRT, and I
wanted something that would be completely stable and dependable. That made it
tempting to buy a router with the right capabilities as advertised features
out of the box, and stick with the stock firmware, but I didn&#8217;t want to give
up on the flexibility I&#8217;d become accustomed to (especially, dnsmasq, ability
to run tcpdump, and ability to install extra services). What I actually did
about this is a story for another time. Here, I&#8217;ll just say that after
replacing the OpenWrt router 3 months ago, I haven&#8217;t seen any of the above
problems recur.</p>

<p>Note 1: Actually things took a little hacking before they were great, speaking
of Backfire on WNDR3700 — I initially started setting this up before the final
Backfire release, so I had to compile from source, which was fine because then
and even now, 5GHz radio support doesn&#8217;t work in the precompiled releases. Too
bad, since dual radio support was my reason for choosing the WNDR3700 in the
first place.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/03/19/custom-built-linux-router-no-thanks-to-realtek/">Custom-built Linux Router, (No) Thanks to Realtek</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-03-19T00:00:00-07:00" pubdate data-updated="true">Mar 19<span>th</span>, 2012</time>
        
         | <a href="/blog/2012/03/19/custom-built-linux-router-no-thanks-to-realtek/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>In my last post, I spelled out my requirements for a home router: dependable
and not requiring babysitting or monthly rebooting, but flexible enough to let
me run and control dnsmasq, tcpdump, and VLANs.</p>

<p>When I realized I was seeing so much weirdness at once from my OpenWrt router
as to be circumstantial evidence against OpenWrt itself, I mentioned this to
my officemate and he said &#8220;why don&#8217;t you stop screwing around and install
full-blown Linux?&#8221; Sure, I thought, but that brings up two problems: it
sounded like a huge time suck, and where am I going to find appropriate
hardware to use as a router?</p>

<p>With help from friends I eventually solved the second one, not without paying
a heavy tax in terms of the first (and not in the way I expected): this is
that story.</p>

<p>On the time suck question, it seemed like I would have to learn a lot of new
things to set up and, possibly, maintain a lot of tasks that I was accustomed
to having OpenWrt do for me. I already knew how to install and administer
Linux for standard desktop or server use, but I&#8217;d never myself configured any
advanced networking topologies and my few interactions with iptables had been
painful, so configuring NAT and firewalling and routing and dealing with
multiple network interfaces was daunting (and this box is by definition going
to be exposed to the Internet, so I&#8217;d better get the firewall right). I poked
around and found <a href="http://www.shorewall.net/">shorewall</a>, which exists
basically to configure the parts that I didn&#8217;t already know how to do, and the
more I read about it, the more it seemed a good match for what I was trying to
do.</p>

<p>On the hardware question, I wanted something small and quiet and low-power,
which would fit in my server rack and stay on all the time without running up
my power bill or generating so much heat that it either fails or needs a leaf
blower of a fan. (That basically describes most consumer routers, for which,
generally, the closest thing you can find to a standard Linux distribution
supporting them is OpenWrt. Ahem.)</p>

<p>I also wanted it to have multiple network interfaces, as a router should.
(This may or may not be relevant to the hardware decision, though; read on.) A
router needs a minimum of two interfaces by definition: one for each network
it routes between, so at the minimum, one for the LAN and one for the WAN. The
scenario I had in mind was more complicated, with two separate LANs (one for
my family and one for guests who just want to get their tablet on the
internet), and leaving room for the possibility of multiple internet
providers, so I&#8217;d need at least 3 interfaces, with the option to expand to 4
or more in the future. Now, these don&#8217;t all have to be physical interfaces
built into the router. If the router has USB ports, you can add more that way;
also if you have other physical infrastructure supporting VLANs, you can
multiplex several networks over one physical port. (Again as a comparison to
OpenWrt: standard consumer routers that OpenWrt runs on tend to have 5 ports
and 2 network interfaces; one network interface is connected directly to one
port labeled WAN, and the other interface is connected through a switch chip
to the other 4 ports, which by default are bridged onto a single VLAN but
which can be configured for 4 separate VLANs if that floats your boat.)</p>

<p>After getting some advice from friends and discussing it ad nauseum, I ended
up buying a <a href="http://www.fit-pc.com/web/fit-pc/fit-pc2i-%0Aspecifications/">fit-pc2i</a>, notable because it&#8217;s a standard x86 PC (so I can choose
really any standard Linux distribution or even Windows to run on it), in a
tiny passively cooled case, drawing 6W, and with 2 physical network
interfaces. (I didn&#8217;t like the idea of depending on a bunch of USB network
adapters, and I wasn&#8217;t sure I could rely only on VLAN support to get extra
ports, so I wanted a 2nd port for insurance. Now that I&#8217;ve used it, I think a
single reliable physical network interface + VLAN support would work out
fine.) Those 2 network ports are not enough for my scenario, so I also bought
a <a href="http://www.cisco.com/en/US/products/ps11229/index.html">Cisco SG200-08</a>
switch, which I use solely to add ports, turning 1 into 8.</p>

<p>Having made these decisions, I bought the fit-pc2i and SG200, installed Linux
(Ubuntu 11.10 Server) and dnsmasq and shorewall, configured VLANs between the
router and switch so that various switch ports acted like they were connected
to additional eth1.x interfaces in the router, and started testing things. It
worked fine until I tried a speed test (from a client connected through the
new router which was connected behind my old router); the speed test promptly
hung from the client&#8217;s point of view, and I couldn&#8217;t access the new router
over the network at all. I power cycled the new router, tried again, same
result. I poked around log files, tried to enable the Linux NMI watchdog, and
generally looked for clues without finding anything until I visited the fit-pc
forums and read <a href="http://www.fit-pc.com/forum/viewtopic.php?f=9&amp;t=2383">&#8220;solution for freezes when scp/ftp/nfs with most Linux
dist&#8221;</a>. This pointed the
blame squarely at the Realtek network interfaces, and suggested an alternate
driver as a solution. Once I started investigating fixes for this, I got
really pessimistic at first: <a href="https://www.google.com/search?q=r8169+freeze">a Google query for &#8220;r8169
freeze&#8221;</a> shows a dismaying
number of hits, many in distribution-specific bug reports going back years and
years. I&#8217;d been under the assumption that networking is Linux&#8217;s lifeblood and
that wired networking has long been a solved problem — wireless network
hardware flaky under Linux, sure, any network hardware flaky under Windows,
sure, but wired network hardware flaky under Linux? That was a rude surprise.</p>

<p>Long story shorter, the in-tree driver (open source and provided with Linux
kernels) for this class of Realtek hardware is named r8169. It actually
supports a family of Realtek chips named RTL8111/RTL8168, of which there are
apparently many variants with important programming differences even inside
the same PCI ID, so using lspci won&#8217;t necessarily tell you enough about which
one you have. Realtek also has their own driver, also ostensibly open source
but not included in the standard Linux kernel, called r8168. For years now,
you can find blog posts saying &#8220;I had such and such a problem with r8169 and I
switched to r8168 and it worked better.&#8221; So naturally, I tried r8168, and
found it didn&#8217;t work at all. Upon further investigation, it has completely
broken VLAN support (at least on my hardware, in the 8.027 driver that was
current at the time, in the phase of the moon that obtained at the time): on a
non-virtual interface it worked fine (and without freezing the kernel); frames
that should have an 802.1Q tag added or removed had it done incorrectly, and
would either (outgoing) get ignored by the switch, or (incoming) get ignored
by the kernel. After spending hours running 3 instances of tcpdump (on the
fitpc on the raw interface, on the fitpc on the virtual interface, and on a
separate machine plugged into a switch port on the SG200 mapped to the same
VLAN), I could characterize the problem: outgoing frames were transmitted with
no tag, and get dropped by the switch. Incoming frames with a tag actually had
it stripped and were dispatched properly. I found out about &#8220;ethtool -K&#8221; to
control hardware acceleration of VLAN tagging (does this really benefit from
hardware acceleration? More than it loses from the possibility of someone
screwing it up?), disabled VLAN tag hardware acceleration in both directions,
and found the opposite problem. Just by luck, at this point I re-enabled
hardware acceleration for VLAN tagging only on the RX path, and things started
working. But only on certain ports.</p>

<p>As a recap of what I found to be broken with r8169 and 802.1Q: as the driver
loads by default, it improperly tags packets on the TX path. If I use &#8220;ethtool
-K txvlan off&#8221;, TX works but RX packets are ignored. If I use &#8220;ethtool -K
txvlan off rxvlan off&#8221; followed by &#8220;ethtool -K txvlan off rxvlan on&#8221;, TX and
RX both work, but flakily — some ports and protocols work, some don&#8217;t, and I
don&#8217;t know why but I&#8217;ve spent too much time staring at packet traces and I
don&#8217;t care any more. The driver is broken out of the box, can be made to
almost work by enabling and disabling VLAN tag acceleration in the right order
through an order-dependent set of transitions reminiscent of port knocking,
but still doesn&#8217;t entirely work, and I&#8217;m not going to trust it.</p>

<p>Then, back in r8169-land, I found an Ubuntu bug report, <a href="https://bugs.launchpad.net/ubuntu/+source%0A/linux-backports-modules-3.0.0/+bug/839393?comments=all">Network problem with
the r8169 driver and RTL8111/8168B</a>, in response to which
people said the 3.1 kernel driver seems to work better than the 3.0 kernel
driver, and Leann Ogasawara produced a 3.0 kernel with the 3.1 r8169 driver
grafted in for people to try. So I tried it, and: lo and behold, while my
repro scenario would still provoke a nasty warning and stack trace in
system.log, there was no freeze.</p>

<p>At this point, I reported my findings to both the r8168 maintainers (Realtek)
and the r8169 drivers (Linux netdev mailing list and Francois Romieu). Realtek
didn&#8217;t respond at all. Francois did reply, saying he&#8217;d been fixing a bunch of
problems in this area recently, and the 3.2 driver should work even better
(this was last December, in the final throes of the 3.2 kernel release). I
grabbed a 3.2RC7 kernel, installed it under the Ubuntu 11.10 install I was
using, and it worked fine. No warnings, no backtraces, no freezes.</p>

<p>I haven&#8217;t touched the configuration since; after another week or so of testing
I installed the fitpc + Ubuntu 11.10 + the 3.2RC7 kernel as our main router,
and we haven&#8217;t had any problems with it. Hopefully, the Ubuntu 12.04 release
(which already uses a 3.2 kernel) will install and run fine, and I won&#8217;t have
to worry about this for another another 5 years since 12.04 is an LTS release.</p>

<p>Lessons learned here:</p>

<ul>
<li>VLANs are cool, and I don&#8217;t really need more than one physical interface on the router the way I&#8217;m using it. I recommend the VLAN + separate switch as port splitter technique. But you do want a gigabit network interface if you&#8217;re going to do that.</li>
<li>Realtek was the bane of my existence for a few weeks in December. It looks like I just had bad timing, and if I&#8217;d done the same setup in April using Ubuntu 12.04 with a Linux 3.2 kernel I wouldn&#8217;t have had to learn any of this r8168/r8169 business. But given the history, I wouldn&#8217;t recommend their products. I went so far as to reconsider the whole fitpc choice. But in this form factor, it seems all the alternatives (including other fitpc products) use Realtec NICs.</li>
<li>shorewall makes configuration of NAT routing, firewalling, and traffic shaping much easier, in my opinion, than raw iptables and tc.</li>
<li>Aside from dealing with the Realtek issue, this was less of a time suck than I was expecting.</li>
<li>Including dealing with the Realtek issue, this was more of a time suck than I was expecting.</li>
<li>I&#8217;m happy with the result, though. Treating the fitpc-2i and SG200 as one unit, I have something that&#8217;s about the size and power consumption of the OpenWrt router, except now it&#8217;s got a 1 GHz x86 CPU, 1GB of RAM, 32GB of flash storage, 9 individually addressable network ports, and is still entirely solid state. Those hardware specs only matter inasmuchas they give me plenty of breathing room for future expansion (I don&#8217;t think my actual usage was taxing the much-lower-speced OpenWrt router), but the real bonus is it&#8217;s stable: OpenVPN, dnsmasq and miniupnpd are all behaving as they ought to.</li>
</ul>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/03/08/siri-keeping-the-artificial-in-artificial-intelligence/">Siri, Keeping the &#8220;Artificial&#8221; in &#8220;Artificial Intelligence&#8221;</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-03-08T00:00:00-08:00" pubdate data-updated="true">Mar 8<span>th</span>, 2012</time>
        
         | <a href="/blog/2012/03/08/siri-keeping-the-artificial-in-artificial-intelligence/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>A lot has already been written on
<a href="http://www.apple.com/iphone/features/siri.html">Siri</a>, most of it pretty
polarized — either of the &#8220;it&#8217;s a gimmick nobody uses&#8221;, or the &#8220;wait, but I
use it!&#8221; variety. I don&#8217;t mean to throw fuel on the fire, but I keep trying to
use Siri and haven&#8217;t found it to work well enough to be worth the effort; here
I&#8217;ll present some examples which are both edifying and amusing.</p>

<p>(There&#8217;s one glaring exception to &#8220;I haven&#8217;t found it to work well enough&#8221;:
for straight dictation, it&#8217;s uncannily accurate. If it starts and stops
listening at the right time and doesn&#8217;t encounter a network error — that is,
when it works at all — it almost always transcribes exactly what I said. It&#8217;s
strange to me that Apple brands the dictation feature as part of Siri, because
to my way of thinking they&#8217;re entirely separate layers — dictation or
transcription for turning spoken sounds into text, and then Siri for assigning
a meaning to that text and acting on the meaning — but as far as I can tell,
Apple considers dictation to be a Siri function, so I have to give her credit:
she&#8217;s great at understanding the words I say.)</p>

<p>In the following real-usage examples Siri, while great at understanding what I
say (in all these cases the transcribed query is exactly what I meant to say)
is not so great at understanding what I mean.</p>

<h2>Flight status:</h2>

<p><a href="http://www.flickr.com/photos/67861147@N00/6817153826"><img src="http://farm8.staticflickr.com/7182/6817153826_7ebf673198_z.jpg" alt="IMG_0326" /></a></p>

<p>&#8220;I can&#8217;t help you with flights.&#8221; Actually she did understand what I meant, but
doesn&#8217;t know how to help. That&#8217;s too bad; that seems like a really natural
function for a personal assistant, and one that lends itself well to machine
structured representation and constrained search. I expected Siri would knock
this one out of the park.</p>

<h2>Appointment reminder:</h2>

<p><a href="http://www.flickr.com/photos/67861147@N00/6817153868"><img src="http://farm8.staticflickr.com/7067/6817153868_4654fde34c_z.jpg" alt="IMG_0327" /></a></p>

<p>&#8220;3 weeks from today&#8221; gets interpreted as &#8220;1 week from today&#8221;. (This screenshot
was taken on 2/9, as you can see from the blue marking, and 2/16 where Siri
put the appointment is decidedly not 3 weeks later.) Again, Siri is often
credited (and advertised) as being good at setting up appointments; I expected
her to knock this one out of the park.</p>

<h2>Another appointment reminder:</h2>

<p><a href="http://www.flickr.com/photos/67861147@N00/6817153932"><img src="http://farm8.staticflickr.com/7061/6817153932_13cbbb8f0c_z.jpg" alt="IMG_0364" /></a></p>

<p>&#8220;5 weeks from today&#8221; gets interpreted as &#8220;tomorrow&#8221;. Otherwise, so close.</p>

<h2>Knowledge question:</h2>

<p><a href="http://www.flickr.com/photos/67861147@N00/6817154062"><img src="http://farm8.staticflickr.com/7192/6817154062_5e81c987f7_z.jpg" alt="IMG_0438" /></a></p>

<p>This one is more of a stretch, and I wouldn&#8217;t have been surprised had Siri
fallen back on generic web search, but instead she tries to interpret it and
get the answer from Wolfram Alpha, so points for that. But — and the reason
this rates inclusion in this post — the interpretation she (and/or Wolfram)
chooses is straight up bizarre. (I really had to scratch my head to
deconstruct this. It decided that <a href="http://www.wolframalpha.com/input/?i=king+periodical">&#8220;king&#8221; refers to a
magazine</a> which
apparently has a circulation of 223,000; it decided that &#8220;bed&#8221; is an
abbreviation for &#8221;<a href="http://en.wikipedia.org/wiki/Banana_equivalent_dose">banana equivalent
dose</a>&#8221;; I have no idea
why or how it thinks those concepts are related. If you actually go to wolfram
alpha and search for &#8221;<a href="http://www.wolframalpha.com/input/?i=king+size+bed">king size
bed</a>&#8221;, it actually
understands the topic is &#8220;bed sizes&#8221;, though it has no information. If you
search for &#8221;<a href="http://www.wolframalpha.com/input/?i=king+bed">king bed</a>&#8221;, it
does take &#8220;bed&#8221; to mean the radiation unit, does not take &#8220;king&#8221; to mean the
magazine, and clarifies &#8220;assuming king is a unit&#8221; while offering to &#8220;use king
bed as a bed size topic instead&#8221;. So I think Siri deserves the credit for
taking this from crazy to awesome.)</p>

<h2>And finally, accidental bonus humor:</h2>

<p><a href="http://www.flickr.com/photos/67861147@N00/6817154000"><img src="http://farm8.staticflickr.com/7198/6817154000_f81576cace_z.jpg" alt="IMG_0436" /></a></p>

<p>OK, this wasn&#8217;t meant for Siri&#8217;s ears at all (it&#8217;s not even a question); in
fact I thought I was dictating a text message in the Messages app. (Having
input focus in the wrong spot is a strange and niggling complaint for a touch
platform like iOS, but this is what happens.) Siri&#8217;s interpretation of why I&#8217;d
be telling her about a rat eating my compost is, however, both noteworthy and
disturbing, especially for the establishments it recommends (neither of which
deserve this treatment, I can vouch for).</p>

<p>On a final note, I&#8217;ll reiterate that these are not contrived examples;
excluding the compost-eating rat which was a mistake, this list represents the
last 4 times I tried to use Siri with real intent, and at least 3 of these are
clearly in her domain. With results like these, I don&#8217;t know that I&#8217;ll keep
trying.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/03/08/headphones-that-let-sound-in-but-not-out/">Headphones That Let Sound in but Not Out</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-03-08T00:00:00-08:00" pubdate data-updated="true">Mar 8<span>th</span>, 2012</time>
        
         | <a href="/blog/2012/03/08/headphones-that-let-sound-in-but-not-out/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>When our son Dominic was born, I knew that my wife and I (and he) would start
having diverging sleep schedules for a while, and I suddenly discovered a need
for something I&#8217;d never considered before: headphones that let ambient sound
in but not out (and also umpteen pieces of more traditional baby
paraphernalia, natch). The reason being: if they&#8217;re resting or sleeping and
I&#8217;m not tired but want to stay in the same room, can I work or entertain
myself without bothering them, and also without completely isolating myself
from them? If I&#8217;m listening to music and Vanessa talks or Dominic squawks, I
want to be able to hear them.</p>

<p>This is the opposite of what people usually want when using headphones:
usually, you want the best fidelity possible for the sound playing in the
headphones, without outside noise or distractions. Allowing ambient noise to
intrude on the music is not normally the goal. So, it&#8217;s not a problem with
many ready solutions.</p>

<p>I&#8217;m familiar with the basic headphone designs: in-ear, and open- and closed-
back on-ear. Open-back headphones tend to be comfortable and provide a good
soundstage, but don&#8217;t isolate your ears from the environment (in either
direction), so they&#8217;re not suitable for noisy environments (you&#8217;ll hear the
noise mixed with your music) and they&#8217;re not suitable for quiet environments
with other people nearby (they&#8217;ll hear a tinny, audible, annoying version of
what you&#8217;re listening to). Closed-back and in-ear headphones tend to have a
physical seal between your ears and the outside world, with the headphone
drivers on the inside of that seal, so they isolate you and your music from
the environment — good if you don&#8217;t want to annoy nearby people, or if you
don&#8217;t want to hear ambient noise, but not so good if you need to react to
what&#8217;s going on around you.</p>

<p>In addition to these different physical and acoustic designs for allowing or
blocking sound transfer, there are also active noise-canceling headphones,
which are of the closed or in-ear variety (to physically block most sound
transfer), but further have microphones and some active electronics to pick up
ambient noise, negate it, and play its negative mixed into your audio stream,
to really minimize ambient noise. These are popular for use on airplanes or
other loud environments.</p>

<p>What I&#8217;m looking for here can&#8217;t be an open design because those let too much
sound out, and it can&#8217;t be a passive closed design because those let too
little sound in. Instead, what I want is basically a variant of the active
noise-canceling design with a reverse switch, so that it uses the same
circuitry but instead of negating ambient noise and mixing it with the audio
stream, actually amplifies ambient noise (to a degree proportional to the
volume of the audio stream) and mixes it with the audio stream. Trouble is, I
don&#8217;t know of, and couldn&#8217;t find, any noise-canceling headphones with a
reverse or &#8220;uncancel&#8221; feature. (When I attempted looking for this, I did find
a few people looking for the same thing, mostly for use while running/biking
near traffic, and most of the time they were told to use open headphones,
since outgoing noise transfer isn&#8217;t a concern in that case.)</p>

<p>While I couldn&#8217;t find any noise-uncanceling headphones specifically designed
or marketed as such, I did find two families of products that do essentially
the same thing. The first is video gaming headsets with voice chat support; in
addition to headphones they have a microphone for chat, and while that&#8217;s there
for the purpose of sending what you say to other people, they also mix your
own microphone input back into your ears so you can hear yourself talking. The
second I wouldn&#8217;t have come up with on my own, but was suggested by a gun-nut
friend when I posted a question about this on Facebook: electronic ear muffs
designed for use around intermittent loud noise sources like heavy machinery
and, er, guns, which attempt to block dangerously loud noises but otherwise
keep you immersed in your environment. By design, they&#8217;re more concerned with
incoming sound than outgoing, but the best way of protecting your ears is to
seal them away from external sound and then electronically add back only what
they think you want to hear, and that sealed design minimizes outgoing sound
leakage too.</p>

<p>Having learned this, I tried both of these approaches. I bought <a href="http://www.astrogaming.com/mixamp-5-8">Astro&#8217;s
Mixamp 5.8</a>, which has quite the bag of
tricks: it connects to any headphones and makes them wireless; it also uses
signal processing tricks to try to make a Dolby Digital signal sound like it&#8217;s
coming from a multi-speaker surround sound system even though the headphones
only have 2 drivers; it also mixes the microphone input back into the
headphone output, and even has a mixer dial to fade between &#8220;chat&#8221; and &#8220;game&#8221;
audio. But you don&#8217;t have to use this with a game system; you can also connect
the transmitter to a music player, in which case &#8220;chat&#8221; will just be your own
voice, and &#8220;game&#8221; will be the music.</p>

<p>I also borrowed an <a href="http://www.amazon.com%0A/Howard-Leight-R-01526-Electronic-Earmuff/dp/B001T7QJ9O">Impact Sport Electronic Earmuff</a> from another gun-nut
friend. It&#8217;s battery powered and by default self contained; it feels like
wearing construction earmuffs until you turn it on, at which point you hear a
faint hiss as it channels ambient noise from external microphones into
speakers on the inside of the sound seal. But it also has an &#8220;aux in&#8221; jack
which lets you feed in music or other audio from any sound source with an
analog output.</p>

<p>How&#8217;d they work? The Mixamp, not so well for this purpose — it has many other
nice properties and does a good job of what it was actually designed for, but
I couldn&#8217;t get the mic on any headset I tried to pick up enough ambient noise
to un-isolate me from the room. Now, the chat headsets I tried have
directional mics designed to to pick up the wearer and nothing else, so
they&#8217;re completely not designed for the purpose I was using them for, and I
can&#8217;t really blame them for doing a poor job. I also tried a couple of
separate omnidirectional mics, but couldn&#8217;t get them to pick up any sound at
all when used with the Mixamp. I&#8217;m no microphone expert, and don&#8217;t know what
kind of microphone you&#8217;re supposed to use with this, but I&#8217;m guessing the
output level of the ones I tried was too low. Anyway, I think the theory is
sound, and if I had the right mic (omnidirectional, sensitive enough, and with
the right output level), the Mixamp would do what I want, but I couldn&#8217;t get
it to work in practice.</p>

<p>On the other hand, the electronic earmuffs? Uncanny. When you first put them
on, you can hear almost nothing (like passive ear protection, they&#8217;re designed
to present a strong acoustic seal). Then you turn them on — and auditorily,
they disappear, and you can hear what&#8217;s going on around you. Then you plug in
an external audio source, and suddenly you&#8217;re marching to the beat of a
drummer only you can hear, while still hearing what&#8217;s going on around you.
Exactly the effect I was looking for, and, I repeat, the effect is uncanny. I
had no idea things like this existed. Now, this specific set of earmuffs is
not exactly perfect for my needs — they&#8217;re stiff and not comfortable to wear
for long periods, and they&#8217;re certainly not audiophile sound quality — graded
as headphones they&#8217;re not great, but as something that lets me hear ambient
noise while mixing in a private audio track no one else can hear, they totally
win. And these are just one example of a product category; there are many
others available from other companies, some of which are probably more
comfortable and/or better sounding. (Some of these are designed for all-day
wear for police and soldiers, so they&#8217;d better be comfortable.) All at a
price, of course. But they do exist.</p>

<p>Moral of the story: these electronic earmuffs are pretty cool. And it&#8217;s good
to have gun-nut friends.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/03/07/diesel/">Diesel</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-03-07T00:00:00-08:00" pubdate data-updated="true">Mar 7<span>th</span>, 2012</time>
        
         | <a href="/blog/2012/03/07/diesel/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>When Vanessa and I <a href="http://www.flickr.com/%0Aphotos/metamatt/sets/72157625048747095/with/5091198448/">visited France in the fall of 2010</a>, we spent a week
driving around in a rental car. I didn&#8217;t think too much about the car when
renting it — one broken thing about the rental car industry is it&#8217;s really
hard to know what kind of car you&#8217;re going to get until you pick it up — so I
just reserved something cheap, and when we picked it up, it turned out to be a
<a href="http://en.wikipedia.org/wiki/Citro%C3%ABn_C4_Picasso">Citroën C4 Picasso</a>
with a diesel engine. Nondescript enough, at first, but after a week on the
road with it, I noticed impressively high fuel mileage — somewhere above 50
mpg (approximate since I was doing the calculations in my head and converting
from liters and kilometers).</p>

<p>This 50+ mpg result was while driving around on the good highways where the
speed limit is 130 kph (80 mph). That got me thinking. The only mainstream
cars in the US that gets gas mileage like that are gas-electric hybrids (e.g.
Prius), and even those not at 80 mph; meanwhile, compared to the Prius the C4
has more usable space, and is more fun to drive thanks to its manual
transmission. A car that beats the Prius on performance, packaging and mileage
— why hasn&#8217;t this caught on in the US?</p>

<p>Fast forward most of a year to when Vanessa and I found out she was pregnant,
and I decided that&#8217;s enough reason to sell my 2-seater convertible and get
something more practical, i.e. with back seats and a hard top. And thanks to
that Citroën C4, I decided it should be a manually-shifted diesel.</p>

<p>Once I started shopping, I realized I had a pretty short list to choose from.
The US auto manufacturers think diesel is for trucks; there are no US-made
diesel passenger cars sold here. The Japanese manufacturers make diesel
passenger cars for sale elsewhere but don&#8217;t import them to the US. That leaves
European companies: Audi, BMW, Mercedes and Volkswagen all sell diesel cars
here. But only Volkswagen offers even a single stick-shift model (shame on
you, Audi and BMW — I get pretty annoyed surfing <a href="http://www.audi.de">audi.de</a>
or <a href="http:www.bmw.de">bmw.de</a> and looking at the drivetrain combinations
available in Europe and not here, but that&#8217;s a story for another time).</p>

<p>What I would have chosen if it were available here, or if we lived in Europe:
either an Audi A3 or BMW 3-series with all-wheel-drive, stick shift and
turbodiesel engine. What&#8217;s available here in the US combining a stick shift
with a diesel engine: Volkswagen Golf, Jetta and Passat.</p>

<p>So I&#8217;m now driving a 2011 VW Golf TDI. But before I made that decision, I
realized I needed to understand whether and why diesel vehicles are really
more efficient. Actually, I had 3 questions: - What is diesel fuel, actually,
and does refining it from crude oil come at the expense of usable gasoline? -
Why do diesel engines get better fuel economy than gasoline engines? - Why
does diesel generally cost more at the pump, compared to unleaded gasoline?</p>

<p>which combined into a suspicion that perhaps diesel is effectively condensed
gasoline, and that it costs more and drives you farther because it&#8217;s just
using up more of the original crude oil energy.</p>

<p>Off to Wikipedia: I needed to read the articles on <a href="http://en.wikipedia.org/wiki/Diesel_fuel">Diesel
fuel</a>, <a href="http://en.wikipedia.org/wiki/Diesel_engine">Diesel
engines</a> and <a href="http://en.wikipedia.org/wiki/Crude_oil">petroleum and crude
oil</a>. It turns out my half-baked
hypothesis was well-intentioned but completely wrong. You can read the article
yourself, but to summarize and answer my questions: crude oil is a mix of
hydrocarbons of various chain lengths, ranging from heavy and less volatile
(diesel) to light and more volatile (gasoline, kerosene, etc). Refining oil is
the process of separating out these different hydrocarbons; when you refine a
given amount of crude oil you get some fixed quantity of diesel, gasoline, and
various other products. It&#8217;s not the case that there&#8217;s a tradeoff between
producing diesel vs. the other fuel products; in fact when you produce one (in
a modern refinery) you produce them all, and you want to use and sell them all
for best efficiency. (Contrast this with the situation in the 1800s, when the
only petroleum product we knew how to use was kerosene, so they&#8217;d separate
that out and throw the rest away.)</p>

<p>This also means there&#8217;s no fixed price relationship between diesel and
gasoline; the prices are set by market forces and supply and demand; that
explains why diesel (in California in 2012) generally costs more than even
premium unleaded, but in other places and times it&#8217;s been cheaper than regular
unleaded.</p>

<p>Finally, the efficiency advantage: it turns out diesel is denser than
gasoline, both in terms of mass per volume and energy per volume (this falls
out from the fact that they&#8217;re roughly equivalent in energy per mass).
Diesel&#8217;s energy content is about 15% higher than gasoline, by volume. This
translates directly to a 15% miles-per-gallon for diesel engines.
Additionally, the Diesel cycle is inherently about 20% more efficient than the
gasoline powered Otto cycle, apparently due to higher compression ratio.</p>

<p>What this means is that a diesel engine will typically get 30-40% better fuel
mileage than a comparable gasoline engine, about half of this advantage due to
the energy density of the fuel and half due to the higher compression ratio.</p>

<p>So if your goal is to use less of a scarce natural resource and generate less
polluting emissions, diesels do have a real advantage over gasoline engines. A
pure diesel powertrain is cheaper and lighter than a hybrid gas-electric
powertrain like that of the Prius, and compares favorably for highway mileage,
though not so favorably for stop-and-go driving. A hybrid diesel-electric
should be substantially better than gas-electric for both city and highway
driving, I would imagine (diesel-electric hybrids exist in transit buses, but
at this point, there are no such passenger vehicles).</p>

<p>As for my Golf TDI: I get about 42 mpg door to door on my standard commute (37
miles, most of which is 75 mph highway driving). I can also typically go 500
miles on a tank of fuel, which is a real convenience advantage over most cars.
I wouldn&#8217;t call it a sports car, but it is zippy and fun to drive. Compared to
other high-mpg options available in the US, it strikes a pretty good balance
between performance and fuel economy — I&#8217;d like to see more diesel options
available here including diesel-electric hybrids, though this may be a passing
phase as pure electric cars become more widely available. (Note that the
Citröen C4 I started this post with was significantly more efficient, probably
due to a smaller engine. I already bemoaned the lack of powertrain options
that the Europeans deign to import here, and chose Volkswagen because they
alone import manually shifted diesels, but they&#8217;re not immune to the curation
effect either; in Europe they sell a smaller diesel engine that gets 50+ mpg,
but the US gets only the 2 liter version for which mpg figures in the low 40s
are typical.)</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/02/16/off-the-cuff-reaction-to-os-x-mountain-lion/">Off-the-cuff Reaction to OS X Mountain Lion</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-02-16T00:00:00-08:00" pubdate data-updated="true">Feb 16<span>th</span>, 2012</time>
        
         | <a href="/blog/2012/02/16/off-the-cuff-reaction-to-os-x-mountain-lion/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>After reading about <a href="http://www.apple.com/macosx%0A/mountain-lion/">Apple&#8217;s new Mountain Lion</a>, including coverage from <a href="http://daringfireball.net/2012/02/mountain_lion%20">Daring
Fireball</a> and <a href="http://arstechnica.com/apple/news/2012/02/apple-unleashes-mountain-%0Alion-on-developers-set-for-summer-release.ars">Ars
Technica</a>, my immediate reaction is:</p>

<ul>
<li>Address Book is being renamed Contacts? Great. I can&#8217;t tell you how many times I&#8217;ve typed Command-Space, C-O-N, trying to launch Address Book via Spotlight.</li>
<li>So long Growl? I already said &#8220;so long&#8221; to Growl months ago, since I don&#8217;t like the way old notifications pile up. Notification Center, at least in its iOS incarnation, is much less intrusive.</li>
<li>Messages (the app, with support for, er, messages via iMessage) from the desktop makes perfect sense.</li>
</ul>


<p>But top to bottom, from today&#8217;s announcements, this feels much more like a
collection of iOS apps appearing in OS X, not a revamp of the OS itself. Where
are the system-level changes? OK, Notification Center is system-wide, and
there&#8217;s more iCloud support including document save/load directly to iCloud,
and there&#8217;s Gatekeeper (the ability to ban installation of unsigned apps).
AirPlay mirroring will be useful, but it&#8217;s too bad the current AppleTV limits
the output to 720p. Still, most of the changes (as documented today) are at
the surface.</p>

<p>On the other hand, recent OS X releases (especially Snow Leopard, but also to
a large degree Lion) were about laying new system infrastructure, so maybe
this is perfectly appropriate. Also, compared to Windows, OS X distinguishes
itself more and more by its useful collection of built-in apps, so improving
and extending that collection is fair game. And finally, the name signifies
it&#8217;s a new lion, not a whole new cat.</p>

<p>From which I conclude the meta-news here is that with a plan to update the OS
annually and the ability to roll out these upgrades via the Mac App Store for
$30, we should get used to regular incremental updates, not revolutions every
blue moon. Which is a pretty sane way to develop quality software, really.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/01/20/space-limiting-your-time-machine-network-backups/">Space Limiting Your Time Machine Network Backups</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-01-20T00:00:00-08:00" pubdate data-updated="true">Jan 20<span>th</span>, 2012</time>
        
         | <a href="/blog/2012/01/20/space-limiting-your-time-machine-network-backups/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>As part of the <a href="http://blog.metamatt.com/blog/2012/01/20/nothing-is-as-easy-as-it-%0Ashould-be-ssd-upgrades/">aforementioned office-quieting
project</a>, I wanted spinning disks out of the office, so I
garbage collected 2 1TB drives from external enclosures that had served for
Time Machine, and <a href="http://blog.metamatt.com/blog/2012/01/20/nothing-is-as-easy-as-it-%0Ashould-be-nas-upgrades/">moved them into a NAS
enclosure</a> in the basement.</p>

<p>That solved the noise problem and gave me a bunch more network-attached
storage, but turned off Time Machine; the next step was to re-enable TIme
Machine but back up to the network.</p>

<p>A few years ago setting up Time Machine to back up over the network, to
anything but the Time Capsule mini-NAS that Apple designed for it, took some
minor rocket science (and in my experience caused no shortage of kernel panics
on the client machines); now it&#8217;s more stable and easy to set up, especially
if the network file services are provided by Apple&#8217;s own AFP server. I have
some free space on another RAID array attached to a Mac Mini also in the
basement, perfect for this sort of thing, and so all I had to do was mount
that drive from the client machine, then go to the Time Machine prefpane and
select it for backup. Time Machine creates itself a disk image and goes to
town.</p>

<p>The one problem with this is that it creates a disk image with the same size
as the underlying physical volume. It&#8217;s a sparse image, so it doesn&#8217;t
immediately fill the whole volume, but it will grow to do so over time. That&#8217;s
not good, since I want multiple Time Machine backups to be able to share that
volume, and they&#8217;re not the only thing that lives there.</p>

<p>Googling for solutions to this, I found an article on how to <a href="http://code.stephenmorley.org/articles/time-machine-on-a-network-%0Adrive/">pre-create the
sparseimage with whatever size you
want</a>. I tried that, but when I enabled Time Machine, it ignored the
hostname_macaddress.sparseimage directory and just created a new
hostname.sparseimage directory next to it. (Which, IMHO, is a good thing,
since keying the backup name from the MAC address is not going to work well
with machines with multiple network interfaces, for example a laptop which is
sometimes using Ethernet and sometimes using Wi-Fi.) Maybe that&#8217;s a holdover
from a previous OS version; who knows. So then I tried precreating the image
file as just hostname.sparseimage, but then when I enabled Time Machine to the
same volume, it noticed the existing one, decided not to use it, and created
&#8220;hostname 1.sparseimage&#8221; instead.</p>

<p>Then I stumbled on a simpler recipe:</p>

<ol>
<li>Enable Time Machine the normal way (mount a network volume, open System Preferences, go to Time Machine preferences, click Select Disk, and choose the network volume).</li>
<li>Let Time Machine do its thing. It will create a sparse image there with the same size as the underlying volume, and do the initial backup, and (eventually) unmount the sparse image.</li>
<li>Later, when Time Machine is not running, use hdiutil to resize the sparseimage to something smaller. I used &#8220;hdiutil resize -size 750g hostname.sparseimage&#8221; (down from its original 3TB size).</li>
</ol>


<p>Boom. Seems to work fine. After having backed up a little over 400GB, Time
Machine now displays the backup status with &#8220;Available: 385 GB of 3 TB&#8221;, so
after backing up another 385GB, it&#8217;ll start pruning the backup set, instead of
filling the volume and getting confused.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/01/20/observations-on-mobile-platform-speed/">Observations on Mobile Platform Speed</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-01-20T00:00:00-08:00" pubdate data-updated="true">Jan 20<span>th</span>, 2012</time>
        
         | <a href="/blog/2012/01/20/observations-on-mobile-platform-speed/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Over the past 5 years, I&#8217;ve used smartphones from Apple and Palm (powered by
iOS and webOS), and played around with Android devices over the same timeframe
though I&#8217;ve never owned one for daily use.</p>

<p>Still, I find the different design choices at the system level to be very
different, and the results pretty much what you&#8217;d expect for each one:</p>

<ul>
<li>webOS as Palm originally shipped it: apps are written in Javascript and run in an interpreter; the platform doesn&#8217;t swap out virtual memory. I never saw apps crash; it was pretty common to get out-of-memory errors (in the guise of a message that says you&#8217;re trying to do too many things at once and need to close some apps). Apps were pretty slow.</li>
<li>webOS as reinterpreted by the hacker/modder community: apps are still Javascript running in an interpreter, but now there&#8217;s a swapfile pretending there&#8217;s more memory. (I think Palm liked this patch enough they eventually folded it back into their official kernels, actually. And if swapping caused a hit to speed, it was compensated for by the fact that the hacker kernels also overclocked the CPU.) The result with this was a platform on which apps never crashed, and also never run out of memory, but they could be glacially slow. The poster child here was the Google Maps app, which often took so long just to launch — over a minute, no kidding — that it would apparently become confused about why it had launched in the first place, and just draw a white screen. (The bit about confusion is just my narrative, but it often would draw nothing but a white screen, and that seemed to correlate highly with the times it took forever to launch.) You can certainly make the argument that an app that takes a minute to launch to a broken state is no more helpful than an app that crashed; there&#8217;s no panacea here.</li>
<li>iOS: apps are written in Objective C and compiled to native code; there&#8217;s no swapfile I&#8217;m aware of. There are two results here: apps run fast, and they crash often. They crash because they segv from bad code, they crash because malloc returns null and they segv instead of checking for that, and they crash because the platform kills them for using too much memory.</li>
<li>Android: apps are written in Java and run in a JIT-compiled VM (which has gotten faster over time, notably in the 2.3 release); I don&#8217;t know if there&#8217;s a swapfile, but I suspect stock Android releases don&#8217;t have one and mods like CyanogenMod allow one. As I said above, I don&#8217;t have deep experience with Android devices, but my general perception is that on contemporary roughly equivalent hardware, it feels significantly faster than webOS and significantly slower than iOS. (I&#8217;m talking about user perception of speed here, which has to do both with how responsive the UI is and how fast real work gets done. iOS and webOS both pay more attention than Android to keeping the UI responsive, to the best of my knowledge.)</li>
</ul>


<p>So. This evidence is relatively unsurprising and easy to explain — interpreted
code that can have as much memory as it wants never crashes but takes forever
to do anything useful; native code under tight memory management is much
faster and much more crash prone — what&#8217;s interesting to me is that all 3 of
these approaches were considered viable in the marketplace. And I don&#8217;t even
know that the dog slowness of webOS is the reason it failed in the marketplace
(and if HP had poured the right resources into it and actually shipped what
they said they would in 2011, a better optimized webOS 3 running on 2011-class
hardware might not have even felt slow). But even discounting webOS, the other
two approaches are both provably market-viable.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/01/20/nothing-is-as-easy-as-it-should-be-ssd-upgrades/">Nothing Is as Easy as It Should Be: SSD Upgrades</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-01-20T00:00:00-08:00" pubdate data-updated="true">Jan 20<span>th</span>, 2012</time>
        
         | <a href="/blog/2012/01/20/nothing-is-as-easy-as-it-should-be-ssd-upgrades/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Santa, bless the guy, heard me getting annoyed at the sounds of hard drives
spinning up and down in the night, and decided to help me out by bringing me
SSD&#8217;s for my and Vanessa&#8217;s computers.</p>

<p>So, the week after Christmas, I replaced the spinning rust in my (2006) Mac
Pro and her (2009) iMac with <a href="http://amzn.to/wUySKX">Crucial M4 solid state
drives</a>.</p>

<p>This was really easy in the Mac Pro; this machine is the easiest to work on
I&#8217;ve ever owned or used, and that&#8217;s probably why a machine from 2006 is still
ticking along so happily in 2012 &#8211; I&#8217;ve upgraded the RAM twice, the hard
drives three times for bigger/better hard drives and twice more to supplement
and now replace them with SSDs &#8211; I don&#8217;t really feel bottlenecked by 5-year-
old CPUs.</p>

<p>Drive upgrades are not as easy in the iMac. First of all, there are no screws
on the outside of the case; all the guts are behind the glass of the screen,
which is held on by magnets, and you need to remove it with a suction cup.
Seriously. (If you already know this, you probably don&#8217;t find it surprising,
but when I first learned it, I was really surprised.) It&#8217;s actually not as
hard as it sounds, but I did have to buy a suction cup. Then you have to
carefully disconnect a bunch of miniature ribbon cables. I followed the
<a href="http://www.btobey.com/learn/imac-ssd-install.php">walkthrough here</a> because
it has nice pictures, except I couldn&#8217;t actually follow it because the 2009
iMac I was working on, unlike the more recent models, doesn&#8217;t have a 2nd SATA
port. Which means I had to replace the hard drive, instead of adding the SSD
alongside it. That was actually the goal, since I didn&#8217;t want to hear drives
spinning up and down, but it means I had to contend with the <a href="http://blog.macsales.com/2751-proprietary-cable-can-put-the-%0Abrakes-on-upgrading-late-09-imacs">temperature
sensor issue</a>.</p>

<p>There seem to be 5 ways people deal with this:</p>

<ul>
<li>ignore it and deal with loud fans</li>
<li>use aftermarket software to control the fan speed, ignoring drive temperature</li>
<li>buy the cable from the previous generation iMac, which had the temperature sensor outside the hard drive</li>
<li>short out the temperature sensor circuit, which is apparently temperature-sensor code for &#8220;it&#8217;s cool&#8221;</li>
<li>(only on newer iMacs with 2 SATA ports) leave the OEM factory hard drive attached, and add the SSD as a 2nd drive</li>
</ul>


<p>I opted for shorting the pins, as I don&#8217;t want loud fans, don&#8217;t really trust a
software solution, don&#8217;t want to pay and wait for the extra part which seems
to be hard to find now anyway, and don&#8217;t have the newer model with the 2nd
SATA port.</p>

<p>This just leaves the question of how to short the pins. Jumpers from old PC
hard drives would probably do the trick, but I don&#8217;t have any lying around. I
could cut the cable and just short the wires, but I wanted to leave the option
to reverse this procedure if things didn&#8217;t work out.</p>

<p>I ended up making a jumper out of a short piece of one conductor from solid-
core Category 6 network wire. Strip that, bend it in a tight U, jam it inside
the connector at the end of the sensor cable, and it fits nicely. Seems to be
working fine.</p>
</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/blog/page/5/">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
    <a class="next" href="/blog/page/3/">Newer &rarr;</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2013/02/25/os-x-has-a-builtin-wi-fi-network-scanner/">OS X has a builtin Wi-Fi network scanner</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/02/25/a-waterproof-tablet-a-step-in-in-the-right-direction/">A waterproof tablet! A step in in the right direction</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/02/21/speedy-resume/">Speedy resume</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/02/13/two-things-i-didnt-know-about-mac-os-internet-sharing/">Two things I didn&#8217;t know about Mac OS internet sharing</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/02/13/troubleshooting-mac-sleep-problems/">Troubleshooting Mac sleep problems</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating&#8230;</li>
  </ul>
  
  <a href="https://github.com/metamatt">@metamatt</a> on GitHub
  
  <script type="text/javascript">
    $.domReady(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'metamatt',
            count: 0,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>


<section>
  <h1>Latest Tweets</h1>
  <ul id="tweets">
    <li class="loading">Status updating&#8230;</li>
  </ul>
  <script type="text/javascript">
    $.domReady(function(){
      getTwitterFeed("metamatt", 4, false);
    });
  </script>
  <script src="/javascripts/twitter.js" type="text/javascript"> </script>
  
    <a href="http://twitter.com/metamatt" class="twitter-follow-button" data-show-count="false">Follow @metamatt</a>
  
</section>



<section class="googleplus">
  <h1>
    <a href="https://plus.google.com/117348958487049022391?rel=author">
      <img src="http://www.google.com/images/icons/ui/gprofile_button-32.png" width="32" height="32">
      Google+
    </a>
  </h1>
</section>



  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2013 - Matt Ginzton -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'metamatt';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
